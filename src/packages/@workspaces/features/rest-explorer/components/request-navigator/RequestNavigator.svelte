<script lang="ts">
  import {
    RequestSectionEnum,
    type UpdateRequestStateType,
  } from "@workspaces/shared/type";
  import { Label } from "@library/ui";
  export let requestStateSection: string;
  export let onUpdateRequestState: UpdateRequestStateType;
  export let authParameterLength = 0;
  export let authHeaderLength = 0;
  export let paramsLength = 0;
  export let headersLength = 0;
  export let autoGeneratedHeadersLength = 0;

  let tabs: {
    name: string;
    id: RequestSectionEnum;
    count: number;
  }[] = [];

  $: {
    if (
      authParameterLength ||
      authHeaderLength ||
      paramsLength ||
      headersLength ||
      autoGeneratedHeadersLength
    ) {
      tabs = [
        {
          name: "Parameters",
          id: RequestSectionEnum.PARAMETERS,
          count: paramsLength + authParameterLength - 1,
        },
        { name: "Body", id: RequestSectionEnum.REQUEST_BODY, count: 0 },
        {
          name: "Headers",
          id: RequestSectionEnum.HEADERS,
          count:
            headersLength + autoGeneratedHeadersLength + authHeaderLength - 1,
        },
        { name: "Auth", id: RequestSectionEnum.AUTHORIZATION, count: 0 },
      ];
    }
  }

  const handleKeyPress = (event: KeyboardEvent) => {
    if (event.altKey && event.code === "KeyP") {
      onUpdateRequestState({
        requestNavigation: RequestSectionEnum.PARAMETERS,
      });
    } else if (event.altKey && event.code === "KeyH") {
      onUpdateRequestState({ requestNavigation: RequestSectionEnum.HEADERS });
    } else if (event.altKey && event.code === "KeyB") {
      onUpdateRequestState({
        requestNavigation: RequestSectionEnum.REQUEST_BODY,
      });
    } else if (event.altKey && event.code === "KeyA") {
      onUpdateRequestState({
        requestNavigation: RequestSectionEnum.AUTHORIZATION,
      });
    }
  };
</script>

<div class="py-2">
  <!-- Tabs -->
  <div class="d-flex mb-2">
    {#each tabs as tab}
      <button
        class="navigation__link px-1 border-0 me-2 sparrow-fs-12 request-tab me-3 {tab.id ===
        requestStateSection
          ? 'tab-active'
          : ''}"
        role="tab"
        on:click={() => {
          onUpdateRequestState({ requestNavigation: tab.id });
        }}
      >
        <span class="d-flex align-items-center"
          ><span>{tab.name}</span>
          {#if tab.count}
            <span class="ms-1"></span>
            <Label number={tab.count} />
          {/if}
        </span>
      </button>
    {/each}
  </div>
</div>
<svelte:window on:keydown={handleKeyPress} />

<style>
  .navigation__link {
    color: var(--text-secondary-300);
    background-color: transparent;
    border-bottom: 2px transparent;
  }
  .navigation__link:hover {
    color: var(--text-secondary-100);
  }
  .tab-active {
    color: var(--text-secondary-100);
    border-bottom: 2px solid var(--border-primary-200) !important;
  }
</style>
